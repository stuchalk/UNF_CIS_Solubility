<!-- incoming variables from publications (volumes) controller: vol, syss -->
{% extends 'base.html' %}
{% load static %}
{% block title %} Report View {% endblock %}
{% block content %}
<div class="row">
    <div class="col-12 mb-2 mt-2">
        <h3 class="text-center text-primary">Solubility System: {{ vol.name }} from Vol. {{ vol.volume }}</h3>
    </div>
    <div class="col-5">
        <div class="card card-success">
            <div class="card-header font-weight-bold">Metadata</div>
            <div class="card-body">
                <h5>Components:</h5>
                {% if chems %}
                <p>
                    {% for chem in chems %}
                        ({{ chem.compnum }}) {{ chem.substance.name }},
                        {% autoescape off %}{{ chem.substance.formula_html }}{% endautoescape %}; [{{ chem.substance.casno }}]
                        <a href="https://webbook.nist.gov/cgi/cbook.cgi?ID={{ chem.substance.casno }}" target="_blank">NIST WebBook</a>
                        {% if not forloop.last %}<br/>{% endif %}
                    {% endfor %}
                </p>
                {% else %}
                <p>
                    {% for chem in compnts %}
                        ({{ chem.compnum }}) {{ chem.substance.name }},
                        {% autoescape off %}{{ chem.substance.formula_html }}{% endautoescape %}; [{{ chem.substance.casno }}]
                        <a href="https://webbook.nist.gov/cgi/cbook.cgi?ID={{ chem.substance.casno }}" target="_blank">NIST WebBook</a>
                        {% if not forloop.last %}<br/>{% endif %}
                    {% endfor %}
                </p>
                {% endif %}
                <h5>Original Measurements</h5>
                <p>{% for ref in refs %}
                    {% if ref.type == 'original' %}
                        <a href="{{ ref.reference.url }}">{{ ref.reference.citation }}</a>
                        {% if not forloop.last %}<br/>{% endif %}
                    {% endif %}
                {% endfor %}</p>
                {% if vars|length > 0 %}
                    <h5>Variables:</h5>
                    <p>{{ vars }}</p>
                {% endif %}
                <h5>Prepared by:</h5>
                <p>{% for cmplr in cmplrs %}
                    {% if cmplr.role == 'compiler' %}
                        {% if forloop.last %}and {% endif %}
                        {{ cmplr.author.name }}{% if not forloop.last %}, {% endif %}
                    {% endif %}
                {% endfor %}</p>
                <!-- method -->
                <h5>Method/Apparatus/Procedure:</h5>
                <p class="text-justify">
                    {% if method|length > 0 %}
                        {{ method }}
                    {% else %}
                        NA
                    {% endif %}
                </p>
                <!-- chemicals -->
                {% if chems|length > 0 %}
                    <h5>Source and Purity of Materials:</h5>
                    <p>{% for chem in chems %}
                            ({{ chem.compnum }}) {{ chem.purity }}
                            {% if not forloop.last %}<br/>{% endif %}
                    {% endfor %}</p>
                {% endif %}
                <!-- references -->
                {% if mrefs %}
                    <h5>References</h5>
                    <p>{% for mref in mrefs %}
                        [{{ mref.methodrefnum }}] <a href="{{ mref.reference.url }}">{{ mref.reference.citation }}</a>
                        {% if not forloop.last %}<br/>{% endif %}
                    {% endfor %}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-7">
        <div class="card card-info">
            <div class="card-header font-weight-bold">Experimental Data</div>
            <div class="card-body">
                {% if series|length > 0 %}
                    {% for table in series %}
                        {% with tablenum=forloop.counter %}
                            <div class="text-center font-weight-bold">{{ table.heading }}</div>
                            <table class="table table-striped">
                                <!-- header -->
                                {% for point in table.datapoints %}
                                    {% with pointnum=forloop.counter %}
                                        {% if pointnum == 1 %}
                                            <thead><tr>
                                            {% for cond in point.conditions %}
                                            <th class="font-weight-bold" scope="col">{{ cond.quantity.symbol }} ({{ cond.unit.symbol }})</th>
                                            {% endfor %}
                                            {% for data in point.data %}
                                            <th class="font-weight-bold" scope="col">{{ data.quantity.symbol }}
                                                {% if data.compnum != None %}<sub>{{ data.compnum }}</sub>{% endif %}
                                                ({{ data.unit.symbol }})</th>
                                            {% endfor %}
                                            </tr></thead>
                                        {% endif %}
                                    {% endwith %}
                                {% endfor %}
                                <!-- body -->
                                <tbody>
                                {% for point in table.datapoints %}
                                    <tr>
                                        {% for cond in point.conditions %}
                                            <td>{{ cond.text }}
                                                {%  if cond.error != None %}(± {{ cond.error }}){%  endif %}
                                            </td>
                                        {% endfor %}
                                        {% for data in point.data %}
                                            <td>{{ data.text }}
                                                {%  if data.error != None %}(± {{ data.error }}){%  endif %}
                                            </td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% endwith %}
                    {% endfor %}
                {% endif %}
                {% if points|length > 0 %}
                    <h4>Datapoints</h4>
                    {% for point in points %}
                        {% with num=forloop.counter %}
                            <h5>Point {{ num }}</h5>
                            <ul>
                            {% for cond in point.conditions %}
                                <li>{{ cond.quantity.name }}: {{ cond.text }} {{ cond.unit.symbol }}</li>
                            {% endfor %}
                            {% for data in point.data %}
                                <li>{{ data.quantity.name }}: {{ data.text }} {{ data.unit.symbol }}</li>
                            {% endfor %}
                            </ul>
                        {% endwith %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
{#    <div class="col-12">#}
{#        <pre> {% debug %} </pre>#}
{#    </div>#}
</div>
{% endblock %}